#!/usr/bin/env bash
set -e

source 'bin/lib/tools'

dir=$PWD
if [[ ! "$dir/bin/install" -ef "$0" ]]; then
  echo "Please run 'bin/install' from dotfiles root folder"
  exit 1
fi

# Ensure presence of directory for vim undo files
undo_dir_path="Library/Vim/undo"
if [ ! -d $HOME/$undo_dir_path ]; then
  echo -n "Creating"
  mkdir -p $HOME/$undo_dir_path
fi

# Symlink dotfiles
includes=".vim"
excludes=".gitignore"
base="$(find . -maxdepth 1 -name '.*' -not -name '.*.local' -type f | sed 's#^\./##' | grep -vF $excludes)"
files="$base $includes"

for dotfile in $files; do
  source_path="$dir/$dotfile"
  target_path="$HOME/$dotfile"

  [ -e $source_path ] || continue

  link $source_path $target_path
done

# Install Vim Bundles
source "bin/vimbundles"
